<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <title>Shadowsocks的原理</title>
  <meta name="description" content="相信很多喜欢Google、Youtube、FaceBook…又具有折腾精神的墙内常住民，都有一段和GFW作战从乐此不疲到疲惫不堪的VPN折腾史，直到clowwindy大神说”要有光”，于是便有了Shadowsocks，迅速成为了比VPN更适合翻墙的利器，在这里把Shadowsocks的原理简单梳理一下">
  <meta name="author" content="leopardpan">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Shadowsocks的原理">
  <meta name="twitter:description" content="相信很多喜欢Google、Youtube、FaceBook…又具有折腾精神的墙内常住民，都有一段和GFW作战从乐此不疲到疲惫不堪的VPN折腾史，直到clowwindy大神说”要有光”，于是便有了Shadowsocks，迅速成为了比VPN更适合翻墙的利器，在这里把Shadowsocks的原理简单梳理一下">
  
  <meta property="og:type" content="article">
  <meta property="og:title" content="Shadowsocks的原理">
  <meta property="og:description" content="相信很多喜欢Google、Youtube、FaceBook…又具有折腾精神的墙内常住民，都有一段和GFW作战从乐此不疲到疲惫不堪的VPN折腾史，直到clowwindy大神说”要有光”，于是便有了Shadowsocks，迅速成为了比VPN更适合翻墙的利器，在这里把Shadowsocks的原理简单梳理一下">
  
  <link rel="icon" type="image/png" href="/images/favicon.png" />
  <link href="/images/favicon.png" rel="shortcut icon" type="image/png">
  
  <link rel="stylesheet" href="/css/main.css">
  <link href="//netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">

  <link rel="canonical" href="http://localhost:4000/2018/02/Shadowsocks%E7%9A%84%E5%8E%9F%E7%90%86/">
  <link rel="alternate" type="application/rss+xml" title="番茄_summer" href="http://localhost:4000/feed.xml">
  
  <meta name="google-site-verification" content="1-1ZlHoRvM0T2FqPbW2S-qLgYXN6rsn52kErlMPd_gw" />

<!-- 站点统计 -->
  <script 
  async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
  </script>  

<!-- 百度统计 -->
  

<!-- google 统计 -->
  

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
  (adsbygoogle = window.adsbygoogle || []).push({
    google_ad_client: "ca-pub-9005224472374751",
    enable_page_level_ads: true
  });
</script>

</head>


  <body>

    <span class="mobile btn-mobile-menu">        
      <div class="nav_container">
         <nav class="nav-menu-item" style = "float:right">
            <i class="nav-menu-item">
              <a href="/#blog" title="" class="blog-button">  博客主页
              </a>
            </i>
            
                <i class="nav-menu-item">

                  <a href="/archive" title="archive" class="btn-mobile-menu__icon">
                      所有文章
                  </a>
                </i>
            
                <i class="nav-menu-item">

                  <a href="/tags" title="tags" class="btn-mobile-menu__icon">
                      标签
                  </a>
                </i>
            
                <i class="nav-menu-item">

                  <a href="/about" title="about" class="btn-mobile-menu__icon">
                      关于我
                  </a>
                </i>
            
          </nav>
      </div>
    </span>
    
    <header class="panel-cover panel-cover--collapsed" style="background-image: url('/images/background-cover.jpg')">
  <div class="panel-main">

    <div class="panel-main__inner panel-inverted">
    <div class="panel-main__content">
        <!-- 头像效果-start -->
        <div class="ih-item circle effect right_to_left">            
            <a href="/#blog" title="前往 番茄_summer 的主页" class="blog-button">
                <div class="img"><img src="/images/avatar.jpg" alt="img"></div>
                <div class="info">
                    <div class="info-back">
                        <h2> 
                            
                                番茄
                            
                        </h2>
                        <p>
                           
                                C++ / Python
                            
                        </p>
                    </div>
                </div>
            </a>
        </div>
        <!-- 头像效果-end -->
        <h1 class="panel-cover__title panel-title"><a href="/#blog" title="link to homepage for 番茄_summer" class="blog-button">番茄_summer</a></h1>
        
        <span class="panel-cover__subtitle panel-subtitle">BLOG</span>
        
        <hr class="panel-cover__divider" />
        <p class="panel-cover__description">River flows in summer</p>
        <hr class="panel-cover__divider panel-cover__divider--secondary" />
        
        
        

        <div class="navigation-wrapper">
          <div>
            <nav class="cover-navigation cover-navigation--primary">
              <ul class="navigation">
                <li class="navigation__item"><a href="/#blog" title="" class="blog-button">博客主页</a></li>
                
                  <li class="navigation__item"><a href="/archive" title="archive">所有文章</a></li>
                
                  <li class="navigation__item"><a href="/tags" title="tags">标签</a></li>
                
                  <li class="navigation__item"><a href="/about" title="about">关于我</a></li>
                
              </ul>
            </nav>
          </div>          
        </div>


        </div>
      </div>
    </div>
    
    
    <div class="panel-cover--overlay cover-clear"></div>
    
  </div>
</header>


    <div class="content-wrapper">
        <div class="content-wrapper__inner">
            <article class="post-container post-container--single" itemscope itemtype="http://schema.org/BlogPosting">
  <header class="post-header">
    <h1 class="post-title">Shadowsocks的原理</h1>
    <div class="post-meta">
      <img src="/images/calendar.png" width="20px"/> 
      <time datetime="2018-02-26 00:00:00 +0800" itemprop="datePublished" class="post-meta__date date">2018-02-26</time>  
         
      <span id="busuanzi_container_page_pv"> | 阅读：<span id="busuanzi_value_page_pv"></span>次</span>
    </p>
    </div>
  </header>

  <section class="post">
    <p>相信很多喜欢Google、Youtube、FaceBook…又具有折腾精神的墙内常住民，都有一段和GFW作战从乐此不疲到疲惫不堪的VPN折腾史，直到clowwindy大神说”要有光”，于是便有了Shadowsocks，迅速成为了比VPN更适合翻墙的利器，在这里把Shadowsocks的原理简单梳理一下</p>

<h3 id="很久很久以前">很久很久以前…</h3>

<p>很久很久以前，当天朝还没有GFW(Great Firewall of China，中国国家防火墙，俗称“墙”)，网民们访问各种网站都是简单而直接的，用户的请求通过互联网直接发送到服务提供方，服务提供方直接将信息反馈给用户</p>

<p><img src="/images/posts/Shadowsocks/image1.png" alt="" /></p>

<h3 id="出现了一堵墙">出现了一堵墙</h3>

<p>然后有一天，GFW就出现了，GFW像一堵墙一样夹在了在用户和海外服务之间，每当用户需要获取海外服务，都需要经过GFW，GFW将它不喜欢的内容统统过滤掉，于是客户当触发GFW的过滤规则的时候，就会收到 <code class="highlighter-rouge">Connection Reset</code> 这样的响应内容，而无法接收到正常的内容 </p>

<p><img src="/images/posts/Shadowsocks/image2.png" alt="" /></p>

<h3 id="用代理绕过墙">用代理绕过墙</h3>

<p>聪明的人们想到了利用海外服务器代理的方法来绕过GFW的过滤规则，其中包含了各种HTTP代理服务、Socks服务、VPN服务…其中以ssh tunnel的方法比较有代表性：</p>

<p>1) 首先用户和境外服务器基于ssh建立起一条加密的通道；</p>

<p>2~3) 用户通过建立起的隧道进行代理，通过ssh server向真实的服务发起请求；</p>

<p>4~5) 服务通过ssh server，再通过创建好的隧道返回给用户</p>

<p><img src="/images/posts/Shadowsocks/image3.png" alt="" /></p>

<h3 id="然而">然而…</h3>

<p>由于ssh本身基于RSA加密技术，所以GFW无法从数据传输的过程中，获取用户真实的服务请求与过滤规则进行比较，避免了被重置链接的问题</p>

<p>但由于创建隧道和数据传输的过程中，ssh本身的特征是明显的，所以GFW通过分析连接的特征进行干扰，导致ssh存在被定向进行干扰的问题</p>

<h3 id="shadowsocks出现">Shadowsocks出现</h3>

<p>于是clowwindy大神创造并开源了他的解决方案Shadowsocks，简单理解的话，Shadowsocks是将原来 ssh创建的Socks5协议拆开成Server端和Client端，所以下面这个原理图基本上和利用ssh tunnel大致类似：</p>

<p>1&amp;6) 客户端发出的请求基于Socks5协议跟SS Local端进行通讯，由于这个SS Local一般是本机或路由器或局域网的其他机器，不经过GFW，所以解决了上面被GFW通过特征分析进行干扰的问题；</p>

<p>2&amp;5) SS Local和SS Server两端通过多种可选的加密方法进行通讯，经过GFW的时候是常规的TCP包，没有明显的特征码而且GFW也无法对通讯数据进行解密；</p>

<p>3&amp;4) SS Server将收到的加密数据进行解密，还原原来的请求，再发送到用户需要访问的服务，获取响应原路返回</p>

<p><img src="/images/posts/Shadowsocks/image4.png" alt="" /></p>

<h3 id="shadowsocks未来的一小片乌云">Shadowsocks未来的一小片乌云</h3>

<p>Shadowsocks近乎完美，然而随着机器学习和AI的越发成熟，干扰Shadowsocks也已经成为了可能，基于机器学习的随机森林算法(Random Forest Algorithm)在探测Shadowsocks流量时已经取得了超过85%的准确率 <a href="http://ieeexplore.ieee.org/document/8048116/?reload=true#full-text-section">IEEE论文地址</a></p>

<h3 id="题外话">题外话</h3>

<p>曾经出现过所谓“增强版”ShadowsocksR引发争议，ShadowsocksR基于Shadowsocks代码进行二次开发，又违反GPL开源协议闭源，clowwindy大神曾经有过如下评论 <a href="https://github.com/shadowsocks/shadowsocks-windows/issues/293#issuecomment-132253168">GitHub评论原文</a>：</p>

<blockquote>
  <p>我一直想象的那种大家一起来维护一个项目的景象始终没有出现，也没有出现的迹象。维护这个项目的过程中，遇到 @chenshaoju 这样主动分享的同学并不多。很多来汇报问题的人是以一种小白求大大解决问题，解决完就走人的方式来的，然而既不愿提供足够的信息，也不愿写一些自己尝试的过程供后人参考。互帮互助的气氛就是搞不起来。对比下国外的社区差好远。</p>
</blockquote>

<blockquote>
  <p>最适合这个民族的其实是一群小白围着大大转，大大通过小白的夸奖获得自我满足，然后小白的吃喝拉撒都包给大大解决的模式。通过这个项目我感觉我已经彻底认识到这个民族的前面为什么会有一堵墙了。没有墙哪来的大大。所以到处都是什么附件回帖可见，等级多少用户组可见，一个论坛一个大大供小白跪舔，不需要政府造墙，网民也会自发造墙。这尼玛连做个翻墙软件都要造墙，真是令人叹为观止。这是一个造了几千年墙的保守的农耕民族，缺乏对别人的基本尊重，不愿意分享，喜欢遮遮掩掩，喜欢小圈子抱团，大概这些传统是改不掉了吧。</p>
</blockquote>

<blockquote>

</blockquote>



  </section>
</article>


            <section class="footer">
    <footer>
        <div class = "footer_div">  
        <nav class="cover-navigation navigation--social">
          <ul class="navigation">

          

          
          <!-- Github -->
          <li class="navigation__item_social">
            <a href="https://github.com/summerffly" title="@summerffly 的 Github" target="_blank">
              <i class='social fa fa-github fa-2x'></i>
              <span class="label">Github</span>
            </a>
          </li>
          
          
          

          

          <!-- RSS -->
          <li class="navigation__item_social">
            <a href="/feed.xml" rel="author" title="RSS" target="_blank">
              <i class='social fa fa-rss fa-2x'></i>
              <span class="label">RSS</span>
            </a>
          </li>

          

          </ul>
        </nav>

        </div>

        <div class = "footer_div">  
           <p class="copyright text-muted">
            Copyright &copy; 番茄_summer 2018
            </p>
        	<div align="right">
    			<link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.3.0/css/font-awesome.min.css">

          <!-- 访问统计 -->
          <span id="busuanzi_container_site_pv">
          </span>

        </div>
        <div>
    </footer>
</section>

        </div>
    </div>
    
    <script type="text/javascript" src="//code.jquery.com/jquery-1.11.3.min.js"></script>
<script type="text/javascript" src="/js/main.js"></script>

<script type="text/javascript" src="/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>



    
  </body>

</html>
