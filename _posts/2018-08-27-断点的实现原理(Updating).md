---
layout: post
title: 断点的实现原理(Updating)
date: 2018-08-28
tags: Debug调试技术
---

　一个程序员在调试的时候几乎都会去设断点，但是从工作到现在一年多，却从没有考虑过编译器或者操作系统是如何实现程序的调试断点的，知其然，更加需要知其所以然，探索断点背后的实现原理和机制，应该是一个程序员的必经之路

### 断点实现的预思考

　我们可以思考一下，如果需要让我们来设计一种断点的实现方式，应该怎么去设计？

　首先，不可能通过在目标程序里插入了代码来实现断点，因为断点可以动态添加或者取消，如果是在生成目标程序时已经插入了调试代码，显然无法实现这种动态特性

　其次，不可能通过动态的在进程中插入跳转或者其他调试指令，因为目标程序被操作系统载入内存以后，跳转指令的跳转地址就已经确定，如果再插入调试指令，之前的跳转指令就错了

　最可行的方法就是利用操作系统提供的寄存器，在寄存器里面存放存了调试断点的位置，操作系统每次执行一条命令（或者一组原子命令）以后就查看一下是否到了断点的地方，再确定是跳转到调试程序，还是继续执行

　实际上调试断点就是通过调试寄存器实现的！

### 本文参考链接

[调试寄存器 原理与使用](https://blog.csdn.net/nishuodeqianshou/article/details/9405115)


