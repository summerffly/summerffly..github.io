---
layout: post
title: Windows消息结构
date: 2018-03-29
tags: Windows消息机制
---

　Windows系统以消息为基础(message based)，以事件为驱动(event driven)，Windows应用程序的进行依靠发生的事件来驱动，事件最终会以消息的形式通知应用程序，因此Windows的消息结构体MSG是Windows系统中最基本、也是最重要的核心之一

### Windows消息结构

　Windows的消息结构体MSG完成声明如下(可查阅MSDN)：

```
typedef struct tagMSG
{
　HWND hwnd;
　UNIT message;
　WPARAM wParam;
　LPARAM lParam;
　DWORD time;
　POINT point;
} MSG;
```

- HWND hwnd：表示接受该消息的窗口句柄

- UNIT message：表示消息标识符(消息值)，message是MSG结构体中最重要的成员，也是MSG结构体的核心

	所有窗口消息定义为具有指定值的宏，用 `WM_` 作为前缀，前缀之后是描述消息名，比如窗口重新确定尺寸的消息值为 `WM_SIZE(0x0005)`

- WPARAM wParam & LPARAM lParam：都是32位的特定附加信息，wParam和lParam的确切含义取决于message消息值，message消息值不同，wParam和lParam表示的附加信息也就不同

	wParam和lParam这两个成员的命名方式是Win16系统时代遗留下来的产物，在Win16 API中WndProc()有两个参数：一个是WORD类型的16位整型变量，另一个是LONG类型的32位整型变量，根据匈牙利命名法，16位的变量就被命名为wParam, 32位的变量就被命名为lParam，到了Win32系统时代中，原来的16位变量也被扩展为32位，因此现在wParam和lParam的大小完全相同

- DWORD time：表示消息送至消息队列的时间

- POINT point：表示消息发送时鼠标在屏幕坐标系中的位置，POINT为嵌套结构成员，他的定义如下：
```
typedef struct tagPOINT
{
　LONG x;
　LONG y;
} POINT;
```

### Windows消息分类

　以 `WM_USER` 和 `WM_APP` 两个预定义的宏为界，Windows消息范围可以分为以下几类：
```
#define WM_USER  0x0400 
#define WM_APP  0x8000
```

- 系统预留消息( Messages reserved for use by the system )

	消息范围：0 ~ WM_USER – 1

- 自定义窗口类消息( Integer messages for use by private window classes  )

	消息范围：WM_USER ~ WM_APP – 1

- 应用程序自定义消息( Messages available for use by applications )

	消息范围：WM_APP ~ 0xBFFF
	
- 应用程序字符串消息( String messages for use by applications )

	消息范围：0xC000 ~ 0xFFFF
	
- 系统预留( Reserved by the system  )

	消息范围：0xFFFF ~

### 常用Windows消息表

- WM_CREATE( 0x0001 ): 创建一个窗口

- WM_DESTROY( 0x0002 ): 销毁一个窗口

- WM_SIZE( 0x0005 ): 改变一个窗口的大小

- WM_PAINT( 0x000F ): 要求一个窗口重画自己

- WM_NOTIFY( 0x004E ): 当某个控件的某个事件已经发生或这个控件需要得到一些信息时，发送此消息给它的父窗口

- WM_KEYDOWN( 0x0100 ): 按下一个键

- WM_KEYUP( 0x0101 ): 释放一个键

- WM_COMMAND( 0x0111 ): 当用户选择一条菜单命令项或当某个控件的某个事件已经发生或这个控件需要得到一些信息时，发送此消息给它的父窗口

- WM_TIMER( 0x0113 ): 发生了定时器事件

- WM_HSCROLL( 0x0114 ): 当一个窗口标准水平滚动条产生一个滚动事件时发送此消息给那个窗口，也发送给拥有它的控件

- WM_VSCROLL( 0x0115 ): 当一个窗口标准垂直滚动条产生一个滚动事件时发送此消息给那个窗口，也发送给拥有它的控件

- WM_MOUSEMOVE( 0x0200 ): 移动鼠标

- WM_LBUTTONDOWN( 0x0201 ): 按下鼠标左键

- WM_LBUTTONUP( 0x0202 ): 释放鼠标左键

- WM_LBUTTONDBLCLK( 0x0203 ): 双击鼠标左键

- WM_RBUTTONDOWN( 0x0204 ): 按下鼠标右键

- WM_RBUTTONUP( 0x0205 ): 释放鼠标右键

- WM_RBUTTONDBLCLK( 0x0206 ): 双击鼠标右键


